name: Build gRPC Win
agent:
  type: Unity::VM
  image: ml-agents/ml-agents-grpc-builder-win:latest
  flavor: b1.large
commands:
  - |
    call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Auxiliary\Build\vcvarsall.bat" x64
    call "%VS150COMNTOOLS%..\..\VC\vcvarsall.bat" x64
    git submodule update --init
    md artifacts\native\win
    md .build
    cd .build
    cmake .. -GNinja -DCMAKE_BUILD_TYPE=Release
    cmake --build . --target grpc_csharp_ext
    copy *.dll ..\artifacts\native\win\
artifacts:
  libraries:
    paths:
      - "artifacts/**"
